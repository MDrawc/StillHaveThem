var view = '<%= @view %>';
<% if @errors.empty? %>
    UIkit.notification({
        message: $('<div/>').html('<%= @message %>').text(),
        pos: 'top-right',
        timeout: 5000
    });
    var reopen = false;
    var new_game_id = '<%= @new_game_id %>';
    if (view === 'panels') {
        reopen = $('#g-drop-' + '<%= @game_id %>').attr('style') == 'display: block;';
    }
    var data = { type: 'refresh', view: view };
    data = addRqRsToData(data);
    var $pagi = $('#pr').find('em.current');
    if ($pagi.length) {
        var current_page = $pagi.text();
        data['page'] = current_page;
    }
    var scroll = $(document).scrollTop().valueOf();
    var new_platform = '<%= @new_platform %>';
    updatePlatformsFilter(new_platform);

    $.ajax({
        url: '/collections/<%= @collection.id %>',
        data: data,
        complete: function(data) {

            $(document).scrollTop(scroll);

            if (reopen) {
                $('#g-drop-' + new_game_id).show();
            }
        }
    });

<% else %>
    if (view === 'list') {
        var $errors = $("#t-ops").find(".add-form-errors");
        var is_list = true;
    } else {
        var $errors = $("#f-lone").find(".add-form-errors");
        var is_list = false;
    }
    $errors.html("<%= j(render partial: 'add_form_errors', locals: { errors: @errors }) %>");
    resetFormErrors(is_list);
<% end %>
