var game_id = '<%= @game_id %>'
var msg = '<%= @message %>';
var msg_pos = 'top-right';
var success = <%= @errors.empty? %>;

// Notifications position depends on offcanvas position
if ($('.uk-offcanvas-container').length) {
    var offc_class = $('.uk-offcanvas-container').attr('class');

    if (offc_class.includes('uk-offcanvas-flip')) {
        msg_pos = 'top-left';
    }
}

if (msg) {
    UIkit.notification({
        message: $('<div/>').html(msg).text(),
        pos: msg_pos,
        timeout: 5000
    });
}

if (success) {
    UIkit.dropdown("#copy-form-" + game_id).hide();
    <% if @current == @collection %>
        if ($('em.current').length == 0) {
            $.ajax({
             url: '/collections/<%= @current.id %>',
             data: { type: 'refresh' }
            });
        } else {
            var current_page = $('em.current').text();
            $.ajax({
                url: '/collections/<%= @current.id %>',
                data: { page: current_page, type: 'refresh' }
            });
        }
    <% elsif !@copy %>
        if ($('em.current').length == 0) {
            $.ajax({
                url: '/collections/<%= @current.id %>',
                data: { type: 'refresh' }
             });
        } else {
            var current_page = $('em.current').text();
            var num_of_games = $('.g-panel').length;
            if (num_of_games == 1) {
                current_page -= 1;
            }

            $.ajax({
                url: '/collections/<%= @current.id %>',
                data: { page: current_page, type: 'refresh' }
            });
        }
    <% end %>

} else {
    $("#copy-form-" + game_id + " .add-form-errors").html("<%= escape_javascript(render partial: 'add_form_errors', locals: { errors: @errors }) %>");
    resetFormErrors('copy', game_id);
}
