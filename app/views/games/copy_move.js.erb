var game_id = '<%= @game_id %>'
var msg = '<%= @message %>';
var msg_pos = 'top-right';
var success = <%= @errors.empty? %>;
var view = '<%= @view %>';
var form_type;

if (msg) {
    UIkit.notification({
        message: $('<div/>').html(msg).text(),
        pos: msg_pos,
        timeout: 5000
    });
}

if (success) {

    if (view != 'list') {
        UIkit.dropdown("#copy-form-" + game_id).hide();
    }

    var data = {
        type: 'refresh', view: view
    };

    if ($('#r-q').text().length != 0 && $('#r-s').text().length != 0) {
        search = $('#r-q').text().split(',');
        data['q'] = {
            name_dev_cont: search[0],
            plat_eq: search[1],
            physical_eq: search[2],
            s: $('#r-s').text()
        };
    } else if ($('#r-q').text().length != 0) {
        search = $('#r-q').text().split(',');
        data['q'] = {
            name_dev_cont: search[0],
            plat_eq: search[1],
            physical_eq: search[2]
        };
    } else if ($('#r-s').text().length != 0) {
        data['q'] = {
            s: $('#r-s').text()
        };
    }

    <% if @current == @collection %>

    if ($('.pr em.current').length != 0) {
        var current_page = $('.pr em.current').text();
        data['page'] = current_page;
    }

    <% elsif !@copy %>

    if ($('.pr em.current').length != 0) {
        var current_page = $('.pr em.current').text();
        var num_of_games = $('.g-panel').length;
        if (num_of_games == 1) {
            current_page -= 1;
        }

        data['page'] = current_page;
    }

    <% end %>

    $.ajax({
        url: '/collections/<%= @current.id %>',
        data: data
    });

} else {
    if (view === 'list') {
        $("#t-ops .add-form-errors").html("<%= j(render partial: 'add_form_errors', locals: { errors: @errors }) %>");
        form_type = 'list';
    } else {
        $("#copy-form-" + game_id + " .add-form-errors").html("<%= j(render partial: 'add_form_errors', locals: { errors: @errors }) %>");
        form_type = 'copy';
    }

    resetFormErrors(form_type, game_id);
}
