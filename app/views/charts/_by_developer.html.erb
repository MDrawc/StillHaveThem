<%= content_tag :div, class: 'uk-grid-collapse', 'uk-grid' => '' do %>

  <% dataset_options = { borderWidth: 0, datalabels: { color: '#fff' } }  %>
  <% options = { scales: { xAxes: [{ ticks: { max: data[:max], stepSize: 1 } }]} } %>
  <% colors = ['rgba(73, 171, 138, 1)','rgba(171, 73, 106, 1)'] %>

  <% unless needs_platform %>
    <% dataset_options[:datalabels][:display] = data[:labels_1] %>
    <% options[:layout] = { padding: { top: 20 } } %>
  <% end %>

  <%= bar_chart data[:data_1],
    id: 'dev_a',
    height: "#{ data[:height_1] }px",
    width: '430px',
    stacked: true,
    dataset: dataset_options,
    library: options,
    colors: colors,
    messages: { empty: "No data" }
    %>

  <% if needs_platform %>
    <% options[:layout] = { padding: { top: 32 } } %>
  <% else %>
    <% dataset_options[:datalabels][:display] = data[:labels_2] %>
  <% end %>

  <% options[:legend] = { display: false } %>

  <%= bar_chart data[:data_2],
    id: 'dev_b',
    height: "#{ data[:height_2] }px",
    width: '430px',
    stacked: true,
    dataset: dataset_options,
    library: options,
    colors: colors,
    messages: { empty: "No data" }
    %>

  <% if needs_platform %>
    <%= javascript_tag do %>
      var p_labels_1 = <%= raw data[:p_labels_1] %>;
      var p_labels_2 = <%= raw data[:p_labels_2] %>;
      var d_labels_1 = <%= raw data[:d_labels_1] %>;
      var d_labels_2 = <%= raw data[:d_labels_2] %>;

      var chart = Chartkick.charts["dev_a"].getChartObject();
      chart.data.datasets[0].datalabels = { display: p_labels_1, color: '#fff' };
      chart.data.datasets[1].datalabels = { display: d_labels_1, color: '#fff'};
      chart.update();

      var chart = Chartkick.charts["dev_b"].getChartObject();
      chart.data.datasets[0].datalabels = { display: p_labels_2, color: '#fff' };
      chart.data.datasets[1].datalabels = { display: d_labels_2, color: '#fff'};
      chart.update();
    <% end %>
  <% end %>
<% end %>
