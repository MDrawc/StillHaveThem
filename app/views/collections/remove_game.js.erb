UIkit.notification({
    message: $('<div/>').html('<%= @message %>').text(),
    status: 'warning',
    pos: 'top-right',
    timeout: 5000
});

var data = {
    type: 'refresh',
    view: '<%= @view %>'
};

var $rq = $('#r-q');
var rs = $rq.next().text();
var rq = $rq.text();
if ( rq != ',,on' && rq != ',,') {
    var search = rq.split(',');
    data['q'] = {
        name_dev_cont: search[0],
        plat_eq: search[1],
        physical_eq: search[2],
    };
}

if (rs.length != 0) {
    if (data['q']) {
        data['q']['s'] = rs;
    } else {
        data['q'] = {
            s: rs
        };
    }
}

var $pagi = $('#pr').find('em.current');

if ($pagi.length != 0) {
    var current_page = $pagi.text();

    switch(view) {
        case 'covers':
            var selector = '.game-space';
            break;
        case 'panels':
            var selector = '.g-panel';
            break;
        case 'list':
            var selector = '.t-game';
            break;
    }
    var num_of_games = $(selector).length;
    if (num_of_games == 1) {
        current_page -= 1;
    }

    data['page'] = current_page;
}

var scroll = $(document).scrollTop().valueOf();

$.ajax({
    url: '/collections/<%= @collection.id %>',
    data: data,

    complete: function(data) {
        $(document).scrollTop(scroll);
    }

});
